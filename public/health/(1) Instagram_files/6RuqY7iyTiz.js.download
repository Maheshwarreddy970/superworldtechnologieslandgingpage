;/*FB_PKG_DELIM*/

__d("LSSetBotResponseInfo",["LSArrayGetObjectAt","LSDeserializeFromJsonIntoDictionaryV2.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(b){return c.filter(c.db.table(12).fetch([[[a[1]]],"messageId"]),function(b){return c.i64.eq(b.threadKey,a[0])&&b.messageId===a[1]}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[0]=void 0:(b=a.item,d[0]=b.metadataDataclass)})},function(e){return d[0]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSDeserializeFromJsonIntoDictionaryV2.nop"),d[0]).then(function(a){return a=a,d[2]=a[0],a})},function(a){return d[3]=new c.Map(),d[4]=d[2].keys(),d[5]=c.i64.of_int32(d[4].length),c.i64.gt(d[5],c.i64.cast([0,0]))?c.loopAsync(d[5],function(a){return d[6]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[4],d[6]).then(function(a){return a=a,d[7]=a[0],d[8]=a[1],a})},function(a){return d[9]=d[2].get(d[7]),d[3].set(d[7],d[9])}])}):c.resolve()},function(e){return a[3]!==void 0?c.sequence([function(e){return c.nativeOperation(b("LSDeserializeFromJsonIntoDictionaryV2.nop"),a[3]).then(function(a){return a=a,d[6]=a[0],a})},function(a){return d[7]=new c.Map(),d[8]=d[6].keys(),d[9]=c.i64.of_int32(d[8].length),c.i64.gt(d[9],c.i64.cast([0,0]))?c.loopAsync(d[9],function(a){return d[14]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[8],d[14]).then(function(a){return a=a,d[15]=a[0],d[16]=a[1],a})},function(a){return d[17]=d[6].get(d[15]),d[7].set(d[15],d[17])}])}):c.resolve()},function(a){return d[10]=d[7].get("ai_bot"),d[10]?d[11]=!1:d[11]=!0,d[11]?c.resolve(d[12]=void 0):c.sequence([function(a){return d[14]=new c.Map(),d[15]=d[10].keys(),d[16]=c.i64.of_int32(d[15].length),c.i64.gt(d[16],c.i64.cast([0,0]))?c.loopAsync(d[16],function(a){return d[17]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[15],d[17]).then(function(a){return a=a,d[18]=a[0],d[19]=a[1],a})},function(a){return d[20]=d[10].get(d[18]),d[14].set(d[18],d[20])}])}):c.resolve()},function(a){return d[12]=d[14]}])},function(b){return d[3].set("ai_bot",d[12]),d[13]=c.toJSON(d[3]),c.forEach(c.filter(c.db.table(12).fetch([[[a[1]]],"messageId"]),function(b){return c.i64.eq(b.threadKey,a[0])&&b.messageId===a[1]}),function(b){var c=b.update;b.item;return c({botResponseId:a[2],metadataDataclass:d[13]})})}]):c.forEach(c.filter(c.db.table(12).fetch([[[a[1]]],"messageId"]),function(b){return c.i64.eq(b.threadKey,a[0])&&b.messageId===a[1]}),function(b){var c=b.update;b.item;return c({botResponseId:a[2]})})}]):c.forEach(c.filter(c.db.table(12).fetch([[[a[1]]],"messageId"]),function(b){return c.i64.eq(b.threadKey,a[0])&&b.messageId===a[1]}),function(b){var c=b.update;b.item;return c({botResponseId:a[2],metadataDataclass:a[3]})})}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxSetBotResponseInfoStoredProcedure";a.__tables__=["messages"];e.exports=a}),null);